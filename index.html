<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MinMax</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚽</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --panel: #161921;
    --panel2: #1d2130;
    --accent: #f7c52e;
    --accent2: #e8753a;
    --text: #e8eaf0;
    --muted: #6b7280;
    --border: #252a38;
    --green: #3ecf8e;
    --red: #f04339;
    --blue: #4e8ef7;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    padding: 32px 16px 64px;
    position: relative;
    overflow-x: hidden;
  }

  /* Background grid */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(247,197,46,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(247,197,46,0.03) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }

  .glow-orb {
    position: fixed;
    width: 600px;
    height: 600px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(247,197,46,0.06) 0%, transparent 70%);
    top: -200px;
    right: -200px;
    pointer-events: none;
    z-index: 0;
  }
  .glow-orb2 {
    position: fixed;
    width: 400px;
    height: 400px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(78,142,247,0.05) 0%, transparent 70%);
    bottom: 0;
    left: -100px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    max-width: 860px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }

  /* Header */
  header {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    margin-bottom: 40px;
    flex-wrap: wrap;
    gap: 12px;
  }

  .logo-block h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3rem, 8vw, 5.5rem);
    line-height: 0.9;
    letter-spacing: 2px;
    background: linear-gradient(135deg, #f7c52e 20%, #e8753a 80%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .logo-block span {
    font-size: 0.75rem;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--muted);
    display: block;
    margin-top: 4px;
    font-weight: 500;
  }

  .badge {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: #000;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    padding: 6px 14px;
    border-radius: 4px;
    align-self: center;
    margin-top: 8px;
  }

  /* Top row */
  .top-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }
  @media (max-width: 600px) {
    .top-grid { grid-template-columns: 1fr; }
  }

  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
  }

  /* Shared uppercase label style */
  .card-title,
  .minmax-label,
  .highlight-box .sub {
    font-size: 0.65rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    font-weight: 600;
  }

  .card-title {
    margin-bottom: 20px;
  }

  /* Number of odds selector */
  .count-selector {
    display: flex;
    gap: 8px;
  }

  .count-btn {
    flex: 1;
    padding: 10px;
    background: var(--panel2);
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 1px;
    transition: all 0.15s;
  }
  .count-btn:hover { border-color: var(--accent); color: var(--accent); }
  .count-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #000;
  }

  /* Odds inputs */
  .odds-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  @media (max-width: 600px) {
    .odds-grid { grid-template-columns: 1fr; }
  }

  .odds-row {
    display: flex;
    align-items: center;
    gap: 12px;
    transition: opacity 0.2s;
  }
  .odds-row.disabled { opacity: 0.25; pointer-events: none; }

  .odds-label {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 2px;
    color: var(--accent);
    width: 56px;
    flex-shrink: 0;
  }

  .odds-input {
    flex: 1;
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.15s;
    -moz-appearance: textfield;
  }
  .odds-input::-webkit-inner-spin-button,
  .odds-input::-webkit-outer-spin-button { -webkit-appearance: none; }
  .odds-input:focus { border-color: var(--accent); }

  .pct-badge {
    font-size: 0.8rem;
    color: var(--muted);
    width: 52px;
    text-align: right;
    flex-shrink: 0;
    font-weight: 500;
  }

  /* Min/Max */
  .minmax-row {
    display: flex;
    gap: 12px;
    margin-top: 4px;
  }

  .minmax-block {
    flex: 1;
  }
  .minmax-label {
    margin-bottom: 8px;
    display: block;
  }
  .minmax-input {
    width: 100%;
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 1px;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.15s;
    -moz-appearance: textfield;
  }
  .minmax-input::-webkit-inner-spin-button,
  .minmax-input::-webkit-outer-spin-button { -webkit-appearance: none; }
  .minmax-input:focus { border-color: var(--blue); }

  /* Results */
  .results-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
  }

  .results-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .highlight-box {
    background: var(--panel2);
    border: 1px solid var(--accent);
    border-radius: 10px;
    padding: 14px 20px;
    text-align: center;
  }
  .highlight-box .big-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.8rem;
    line-height: 1;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .highlight-box .sub {
    margin-top: 4px;
  }

  /* Bar chart */
  .bars {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .bar-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .bar-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 1px;
    width: 70px;
    color: var(--muted);
    flex-shrink: 0;
  }
  .bar-num.in-range { color: var(--accent); }

  .bar-track {
    flex: 1;
    height: 28px;
    background: var(--panel2);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
  }

  .bar-fill {
    height: 100%;
    border-radius: 6px;
    transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
  }
  .bar-fill.in-range {
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }
  .bar-fill.out-range {
    background: var(--border);
  }

  .bar-pct {
    font-size: 0.85rem;
    font-weight: 600;
    width: 54px;
    text-align: right;
    flex-shrink: 0;
    color: var(--text);
  }
  .bar-pct.in-range { color: var(--accent); }


  /* Footer */
  footer {
    text-align: center;
    margin-top: 48px;
    color: #2a2f3d;
    font-size: 0.7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 500;
  }


  /* Animations */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .container > * {
    animation: fadeUp 0.5s ease both;
  }
  .container > *:nth-child(2) { animation-delay: 0.05s; }
  .container > *:nth-child(3) { animation-delay: 0.1s; }
  .container > *:nth-child(4) { animation-delay: 0.15s; }

  .info-text {
    font-size: 0.8rem;
    color: var(--muted);
    line-height: 1.6;
    margin-top: 8px;
  }
</style>
</head>
<body>
<div class="glow-orb"></div>
<div class="glow-orb2"></div>

<div class="container">
  <header>
    <div class="logo-block">
      <h1>MinMax</h1>
      <span>Reduceringsanalys &amp; Sannolikhet</span>
    </div>
    <div class="badge">Min &bull; Max</div>
  </header>

  <!-- Top row: Antal odds + Reducering -->
  <div class="top-grid">
    <div class="card">
      <div class="card-title">Antal Matcher</div>
      <div class="count-selector" id="countSelector">
        <button class="count-btn" data-n="1">1</button>
        <button class="count-btn" data-n="2">2</button>
        <button class="count-btn" data-n="3">3</button>
        <button class="count-btn active" data-n="4">4</button>
        <button class="count-btn" data-n="5">5</button>
        <button class="count-btn" data-n="6">6</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">Reducering – Intervall</div>
      <div class="minmax-row">
        <div class="minmax-block">
          <span class="minmax-label">Min rätt</span>
          <input type="number" class="minmax-input" id="minInput" value="1" min="0" max="13">
        </div>
        <div class="minmax-block">
          <span class="minmax-label">Max rätt</span>
          <input type="number" class="minmax-input" id="maxInput" value="3" min="0" max="13">
        </div>
      </div>
    </div>
  </div>

  <!-- Odds per match (full width) -->
  <div class="card" style="margin-bottom:20px;">
    <div class="card-title">Odds per match</div>
    <div class="odds-grid" id="oddsGrid">
      <!-- Generated by JS -->
    </div>
  </div>

  <!-- Results -->
  <div class="results-card">
    <div class="results-header">
      <div>
        <div class="card-title" style="margin-bottom:6px;">Sannolikhetsfördelning</div>
        <p class="info-text">Binomialfördelning baserat på dina odds</p>
      </div>
      <div class="highlight-box">
        <div class="big-num" id="rangeDisplay">—</div>
        <div class="sub">Sannolikhet för valt intervall</div>
      </div>
    </div>

    <div class="bars" id="barsContainer">
      <!-- Generated by JS -->
    </div>
  </div>

  <footer>Made by David Hefner</footer>
</div>

<script>
  let numOdds = 4;
  const oddsValues = [2, 2, 2, 2, 2, 2];

  // Cached DOM references
  const $oddsGrid = document.getElementById('oddsGrid');
  const $minInput = document.getElementById('minInput');
  const $maxInput = document.getElementById('maxInput');
  const $rangeDisplay = document.getElementById('rangeDisplay');
  const $barsContainer = document.getElementById('barsContainer');

  function binomCoef(n, k) {
    if (k < 0 || k > n) return 0;
    if (k === 0 || k === n) return 1;
    let result = 1;
    for (let i = 0; i < k; i++) {
      result *= (n - i) / (i + 1);
    }
    return result;
  }

  function binomDist(k, n, p) {
    if (k < 0 || k > n) return 0;
    return binomCoef(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
  }

  // Single loop instead of slice → map → reduce
  function getAvgP() {
    let sum = 0;
    for (let i = 0; i < numOdds; i++) {
      sum += oddsValues[i] > 0 ? 100 / oddsValues[i] : 0;
    }
    return sum / numOdds / 100;
  }

  function calculate() {
    const p = getAvgP();
    const n = numOdds;
    const minVal = parseInt($minInput.value) || 0;
    const maxVal = parseInt($maxInput.value) || 0;

    // Single pass: distribution, maxProb, and rangeProb
    const probs = new Array(n + 1);
    let maxProb = 0;
    let rangeProb = 0;
    for (let k = 0; k <= n; k++) {
      const prob = binomDist(k, n, p);
      probs[k] = prob;
      if (prob > maxProb) maxProb = prob;
      if (k >= minVal && k <= maxVal) rangeProb += prob;
    }

    $rangeDisplay.textContent = (rangeProb * 100).toFixed(2) + '%';

    // Build bars with DocumentFragment + createElement (avoids innerHTML parsing)
    const fragment = document.createDocumentFragment();
    const fills = [];
    for (let k = 0; k <= n; k++) {
      const prob = probs[k];
      const inRange = k >= minVal && k <= maxVal;
      const barWidth = maxProb > 0 ? (prob / maxProb) * 100 : 0;
      const rangeClass = inRange ? ' in-range' : '';

      const row = document.createElement('div');
      row.className = 'bar-row';

      const numEl = document.createElement('div');
      numEl.className = 'bar-num' + rangeClass;
      numEl.textContent = k + ' rätt';

      const track = document.createElement('div');
      track.className = 'bar-track';

      const fill = document.createElement('div');
      fill.className = 'bar-fill' + (inRange ? ' in-range' : ' out-range');
      fill.style.width = '0%';
      fills.push({ el: fill, target: barWidth });
      track.appendChild(fill);

      const pct = document.createElement('div');
      pct.className = 'bar-pct' + rangeClass;
      pct.textContent = (prob * 100).toFixed(2) + '%';

      row.appendChild(numEl);
      row.appendChild(track);
      row.appendChild(pct);
      fragment.appendChild(row);
    }

    $barsContainer.innerHTML = '';
    $barsContainer.appendChild(fragment);

    // Animate bars
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        for (const { el, target } of fills) {
          el.style.width = target + '%';
        }
      });
    });
  }

  function renderOddsGrid() {
    const fragment = document.createDocumentFragment();
    for (let i = 0; i < 6; i++) {
      const disabled = i >= numOdds;

      const row = document.createElement('div');
      row.className = 'odds-row' + (disabled ? ' disabled' : '');

      const label = document.createElement('div');
      label.className = 'odds-label';
      label.textContent = 'Odds ' + (i + 1);

      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'odds-input';
      input.value = oddsValues[i];
      input.min = '1.01';
      input.step = '0.01';
      if (disabled) input.tabIndex = -1;

      const pctBadge = document.createElement('div');
      pctBadge.className = 'pct-badge';
      pctBadge.textContent = disabled ? '\u2014' : (100 / oddsValues[i]).toFixed(1) + '%';

      // Direct reference to pctBadge — no DOM lookup needed in listener
      input.addEventListener('input', () => {
        const v = parseFloat(input.value);
        if (v > 0) {
          oddsValues[i] = v;
          pctBadge.textContent = (100 / v).toFixed(1) + '%';
          calculate();
        }
      });

      row.appendChild(label);
      row.appendChild(input);
      row.appendChild(pctBadge);
      fragment.appendChild(row);
    }
    $oddsGrid.innerHTML = '';
    $oddsGrid.appendChild(fragment);
  }

  // Count buttons (event delegation)
  document.getElementById('countSelector').addEventListener('click', e => {
    const btn = e.target.closest('.count-btn');
    if (!btn) return;
    numOdds = parseInt(btn.dataset.n);
    document.querySelectorAll('.count-btn').forEach(b => b.classList.toggle('active', b === btn));
    renderOddsGrid();
    calculate();
  });

  // Min/Max inputs
  $minInput.addEventListener('input', calculate);
  $maxInput.addEventListener('input', calculate);

  // Init
  renderOddsGrid();
  calculate();
</script>
</body>
</html>
